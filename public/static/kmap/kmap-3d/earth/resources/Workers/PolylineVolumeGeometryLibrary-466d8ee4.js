define(["exports","./Math-e66fad2a","./Cartesian2-44433f55","./Transforms-23521d7e","./EllipsoidTangentPlane-ae6dc4fa","./PolylinePipeline-9b888896"],function(a,O,N,p,d,V){"use strict";var G=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),R=[new N.Cartesian3,new N.Cartesian3],I=new N.Cartesian3,L=new N.Cartesian3,j=new N.Cartesian3,Q=new N.Cartesian3,F=new N.Cartesian3,U=new N.Cartesian3,_=new N.Cartesian3,q=new N.Cartesian3,Y=new N.Cartesian3,Z=new N.Cartesian3,g=new N.Cartesian3,k={},H=new N.Cartographic;function J(a,e,r,n){var t=a[0],a=a[1],t=N.Cartesian3.angleBetween(t,a),i=Math.ceil(t/n),s=new Array(i);if(e===r){for(l=0;l<i;l++)s[l]=e;return s.push(r),s}for(var o=(r-e)/i,l=1;l<i;l++)s[l]=e+l*o;return s[0]=e,s.push(r),s}var m=new N.Cartesian3,f=new N.Cartesian3;var w=new N.Cartesian3(-1,0,0),h=new p.Matrix4,x=new p.Matrix4,v=new p.Matrix3,B=p.Matrix3.IDENTITY.clone(),z=new N.Cartesian3,S=new p.Cartesian4,P=new N.Cartesian3;function K(a,e,r,n,t,i,s,o){var l=z,C=S,e=(h=p.Transforms.eastNorthUpToFixedFrame(a,t,h),l=p.Matrix4.multiplyByPointAsVector(h,w,l),l=N.Cartesian3.normalize(l,l),l=l,e=e,a=a,t=t,t=new d.EllipsoidTangentPlane(a,t),l=t.projectPointOntoPlane(N.Cartesian3.add(a,l,m),m),t=t.projectPointOntoPlane(N.Cartesian3.add(a,e,f),f),a=N.Cartesian2.angleBetween(l,t),0<=t.x*l.y-t.y*l.x?-a:a),c=(v=p.Matrix3.fromRotationZ(e,v),P.z=i,h=p.Matrix4.multiplyTransformation(h,p.Matrix4.fromRotationTranslation(v,P,x),h),B);c[0]=s;for(var u=0;u<o;u++)for(var y=0;y<r.length;y+=3)C=N.Cartesian3.fromArray(r,y,C),C=p.Matrix3.multiplyByVector(c,C,C),C=p.Matrix4.multiplyByPoint(h,C,C),n.push(C.x,C.y,C.z);return n}var l=new N.Cartesian3;function W(a,e,r,n,t,i,s){for(var o=0;o<a.length;o+=3)n=K(N.Cartesian3.fromArray(a,o,l),e,r,n,t,i[o/3],s,1);return n}function X(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var E=new p.Quaternion,M=new N.Cartesian3,T=new p.Matrix3;function $(a,e,r,n,t,i,s,o,l,C){var c,u=N.Cartesian3.angleBetween(N.Cartesian3.subtract(e,a,Z),N.Cartesian3.subtract(r,a,g)),y=n===G.BEVELED?0:Math.ceil(u/O.CesiumMath.toRadians(5)),d=t?p.Matrix3.fromQuaternion(p.Quaternion.fromAxisAngle(N.Cartesian3.negate(a,Z),u/(y+1),E),T):p.Matrix3.fromQuaternion(p.Quaternion.fromAxisAngle(a,u/(y+1),E),T);if(e=N.Cartesian3.clone(e,M),0<y)for(var m=C?2:1,f=0;f<y;f++)e=p.Matrix3.multiplyByVector(d,e,e),c=N.Cartesian3.subtract(e,a,Z),c=N.Cartesian3.normalize(c,c),t||(c=N.Cartesian3.negate(c,c)),s=K(i.scaleToGeodeticSurface(e,g),c,o,s,i,l,1,m);else c=N.Cartesian3.subtract(e,a,Z),c=N.Cartesian3.normalize(c,c),t||(c=N.Cartesian3.negate(c,c)),s=K(i.scaleToGeodeticSurface(e,g),c,o,s,i,l,1,1),r=N.Cartesian3.clone(r,M),c=N.Cartesian3.subtract(r,a,Z),c=N.Cartesian3.normalize(c,c),t||(c=N.Cartesian3.negate(c,c)),s=K(i.scaleToGeodeticSurface(r,g),c,o,s,i,l,1,1)}k.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var i=a[n],s=a[t];N.Cartesian2.equals(i,s)||r.push(s)}return r},k.angleIsGreaterThanPi=function(a,e,r,n){n=new d.EllipsoidTangentPlane(r,n),a=n.projectPointOntoPlane(N.Cartesian3.add(r,a,m),m),n=n.projectPointOntoPlane(N.Cartesian3.add(r,e,f),f);return 0<=n.x*a.y-n.y*a.x};var aa=new N.Cartesian3,ea=new N.Cartesian3;k.computePositions=function(a,e,r,n,t){var i,s=n._ellipsoid,o=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];H=e.cartesianToCartographic(t,H),r[n]=H.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,s),l=n._granularity,C=n._cornerType,c=(t?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}:X)(e,r),n=t?X(e,r):void 0,u=r.height/2,y=r.width/2,d=a.length,m=[],e=t?[]:void 0,f=I,p=L,g=j,w=Q,h=F,x=U,v=_,P=q,E=Y,M=a[0],T=a[1],B=(w=s.geodeticSurfaceNormal(M,w),f=N.Cartesian3.subtract(T,M,f),f=N.Cartesian3.normalize(f,f),P=N.Cartesian3.cross(w,f,P),P=N.Cartesian3.normalize(P,P),o[0]),z=o[1];t&&(e=K(M,P,n,e,s,B+u,1,1)),E=N.Cartesian3.clone(M,E),M=T,p=N.Cartesian3.negate(f,p);for(var S=1;S<d-1;S++){var A=t?2:1,T=a[S+1],f=N.Cartesian3.subtract(T,M,f),w=(f=N.Cartesian3.normalize(f,f),g=N.Cartesian3.add(f,p,g),g=N.Cartesian3.normalize(g,g),s.geodeticSurfaceNormal(M,w)),b=N.Cartesian3.multiplyByScalar(w,N.Cartesian3.dot(f,w),aa),D=(N.Cartesian3.subtract(f,b,b),N.Cartesian3.normalize(b,b),N.Cartesian3.multiplyByScalar(w,N.Cartesian3.dot(p,w),ea));N.Cartesian3.subtract(p,D,D),N.Cartesian3.normalize(D,D),!O.CesiumMath.equalsEpsilon(Math.abs(N.Cartesian3.dot(b,D)),1,O.CesiumMath.EPSILON7)?(g=N.Cartesian3.cross(g,w,g),g=N.Cartesian3.cross(w,g,g),g=N.Cartesian3.normalize(g,g),b=1/Math.max(.25,N.Cartesian3.magnitude(N.Cartesian3.cross(g,p,Z))),(D=k.angleIsGreaterThanPi(f,p,M,s))?(h=N.Cartesian3.add(M,N.Cartesian3.multiplyByScalar(g,b*y,g),h),x=N.Cartesian3.add(h,N.Cartesian3.multiplyByScalar(P,y,x),x),R[0]=N.Cartesian3.clone(E,R[0]),R[1]=N.Cartesian3.clone(x,R[1]),i=J(R,B+u,z+u,l),m=W(V.PolylinePipeline.generateArc({positions:R,granularity:l,ellipsoid:s}),P,c,m,s,i,1),P=N.Cartesian3.cross(w,f,P),P=N.Cartesian3.normalize(P,P),v=N.Cartesian3.add(h,N.Cartesian3.multiplyByScalar(P,y,v),v),C===G.ROUNDED||C===G.BEVELED?$(h,x,v,C,D,s,m,c,z+u,t):m=K(M,g=N.Cartesian3.negate(g,g),c,m,s,z+u,b,A)):(h=N.Cartesian3.add(M,N.Cartesian3.multiplyByScalar(g,b*y,g),h),x=N.Cartesian3.add(h,N.Cartesian3.multiplyByScalar(P,-y,x),x),R[0]=N.Cartesian3.clone(E,R[0]),R[1]=N.Cartesian3.clone(x,R[1]),i=J(R,B+u,z+u,l),m=W(V.PolylinePipeline.generateArc({positions:R,granularity:l,ellipsoid:s}),P,c,m,s,i,1),P=N.Cartesian3.cross(w,f,P),P=N.Cartesian3.normalize(P,P),v=N.Cartesian3.add(h,N.Cartesian3.multiplyByScalar(P,-y,v),v),C===G.ROUNDED||C===G.BEVELED?$(h,x,v,C,D,s,m,c,z+u,t):m=K(M,g,c,m,s,z+u,b,A)),E=N.Cartesian3.clone(v,E),p=N.Cartesian3.negate(f,p)):(m=K(E,P,c,m,s,B+u,1,1),E=M),B=z,z=o[S+1],M=T}R[0]=N.Cartesian3.clone(E,R[0]),R[1]=N.Cartesian3.clone(M,R[1]),i=J(R,B+u,z+u,l),m=W(V.PolylinePipeline.generateArc({positions:R,granularity:l,ellipsoid:s}),P,c,m,s,i,1),t&&(e=K(M,P,n,e,s,z+u,1,1));d=m.length,r=t?d+e.length:d,n=new Float64Array(r);return n.set(m),t&&n.set(e,d),n},a.CornerType=G,a.PolylineVolumeGeometryLibrary=k});
