define(["exports","./when-cbf8cd21","./Check-35e1a91d","./Math-e66fad2a","./Cartesian2-44433f55","./Transforms-23521d7e","./IntersectionTests-4068523d","./Plane-47e9c397","./EllipsoidRhumbLine-862a2df4","./EllipsoidGeodesic-7779e55a"],function(a,d,e,p,m,w,v,P,T,r){"use strict";var y={numberOfPoints:function(a,e,r){a=m.Cartesian3.distance(a,e);return Math.ceil(a/r)},numberOfPointsRhumbLine:function(a,e,r){a=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(a/(r*r)))}},o=new m.Cartographic,A=(y.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,o).height}return t},new w.Matrix4),E=new m.Cartesian3,R=new m.Cartesian3,b=new P.Plane(m.Cartesian3.UNIT_X,0),S=new m.Cartesian3,M=new P.Plane(m.Cartesian3.UNIT_X,0),D=new m.Cartesian3,x=new m.Cartesian3,N=[];function G(a,e,r){var t=N;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++)t[i]=e+i*n;return t}var I=new m.Cartographic,k=new m.Cartographic,V=new m.Cartesian3,L=new m.Cartesian3,_=new m.Cartesian3,O=new r.EllipsoidGeodesic,B=new T.EllipsoidRhumbLine;y.wrapLongitude=function(a,e){var r=[],t=[];if(d.defined(a)&&0<a.length){e=d.defaultValue(e,w.Matrix4.IDENTITY);for(var e=w.Matrix4.inverseTransformation(e,A),n=w.Matrix4.multiplyByPoint(e,m.Cartesian3.ZERO,E),i=m.Cartesian3.normalize(w.Matrix4.multiplyByPointAsVector(e,m.Cartesian3.UNIT_Y,R),R),o=P.Plane.fromPointNormal(n,i,b),e=m.Cartesian3.normalize(w.Matrix4.multiplyByPointAsVector(e,m.Cartesian3.UNIT_X,S),S),s=P.Plane.fromPointNormal(n,e,M),c=1,l=(r.push(m.Cartesian3.clone(a[0])),r[0]),u=a.length,h=1;h<u;++h){var f,g,C=a[h];(P.Plane.getPointDistance(s,l)<0||P.Plane.getPointDistance(s,C)<0)&&(f=v.IntersectionTests.lineSegmentPlane(l,C,o,D),d.defined(f)&&(g=m.Cartesian3.multiplyByScalar(i,5e-9,x),P.Plane.getPointDistance(o,l)<0&&m.Cartesian3.negate(g,g),r.push(m.Cartesian3.add(f,g,new m.Cartesian3)),t.push(c+1),m.Cartesian3.negate(g,g),r.push(m.Cartesian3.add(f,g,new m.Cartesian3)),c=1)),r.push(m.Cartesian3.clone(a[h])),c++,l=C}t.push(c)}return{positions:r,lengths:t}},y.generateArc=function(a){var e=(a=d.defined(a)?a:{}).positions,r=e.length,t=d.defaultValue(a.ellipsoid,m.Ellipsoid.WGS84),n=d.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r)return l=t.scaleToGeodeticSurface(e[0],L),0!==(n=i?n[0]:n)&&(f=t.geodeticSurfaceNormal(l,V),m.Cartesian3.multiplyByScalar(f,n,f),m.Cartesian3.add(l,f,l)),[l.x,l.y,l.z];for(var o=a.minDistance,s=(d.defined(o)||(f=d.defaultValue(a.granularity,p.CesiumMath.RADIANS_PER_DEGREE),o=p.CesiumMath.chordLength(f,t.maximumRadius)),0),c=0;c<r-1;c++)s+=y.numberOfPoints(e[c],e[c+1],o);var l=3*(s+1),u=new Array(l),h=0;for(c=0;c<r-1;c++)h=function(a,e,r,t,n,i,o,s){var c=t.scaleToGeodeticSurface(a,L),l=t.scaleToGeodeticSurface(e,_),u=y.numberOfPoints(a,e,r),a=t.cartesianToCartographic(c,I),e=t.cartesianToCartographic(l,k),h=G(u,n,i),f=(O.setEndPoints(a,e),O.surfaceDistance/u),g=s,C=(a.height=n,t.cartographicToCartesian(a,V));m.Cartesian3.pack(C,o,g),g+=3;for(var d=1;d<u;d++){var p=O.interpolateUsingSurfaceDistance(d*f,k);p.height=h[d],C=t.cartographicToCartesian(p,V),m.Cartesian3.pack(C,o,g),g+=3}return g}(e[c],e[c+1],o,t,i?n[c]:n,i?n[c+1]:n,u,h);N.length=0;var a=e[r-1],f=t.cartesianToCartographic(a,I),a=(f.height=i?n[r-1]:n,t.cartographicToCartesian(f,V));return m.Cartesian3.pack(a,u,l-3),u};var U=new m.Cartographic,z=new m.Cartographic;y.generateRhumbArc=function(a){var e=(a=d.defined(a)?a:{}).positions,r=e.length,t=d.defaultValue(a.ellipsoid,m.Ellipsoid.WGS84),n=d.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r)return C=t.scaleToGeodeticSurface(e[0],L),0!==(n=i?n[0]:n)&&(h=t.geodeticSurfaceNormal(C,V),m.Cartesian3.multiplyByScalar(h,n,h),m.Cartesian3.add(C,h,C)),[C.x,C.y,C.z];for(var o,s=d.defaultValue(a.granularity,p.CesiumMath.RADIANS_PER_DEGREE),c=0,l=t.cartesianToCartographic(e[0],U),u=0;u<r-1;u++)o=t.cartesianToCartographic(e[u+1],z),c+=y.numberOfPointsRhumbLine(l,o,s),l=m.Cartographic.clone(o,U);var h=3*(c+1),f=new Array(h),g=0;for(u=0;u<r-1;u++)g=function(a,e,r,t,n,i,o,s){var a=t.cartesianToCartographic(a,I),e=t.cartesianToCartographic(e,k),c=y.numberOfPointsRhumbLine(a,e,r),l=(a.height=0,e.height=0,G(c,n,i)),u=((B=B.ellipsoid.equals(t)?B:new T.EllipsoidRhumbLine(void 0,void 0,t)).setEndPoints(a,e),B.surfaceDistance/c),h=s,f=(a.height=n,t.cartographicToCartesian(a,V));m.Cartesian3.pack(f,o,h),h+=3;for(var g=1;g<c;g++){var C=B.interpolateUsingSurfaceDistance(g*u,k);C.height=l[g],f=t.cartographicToCartesian(C,V),m.Cartesian3.pack(f,o,h),h+=3}return h}(e[u],e[u+1],s,t,i?n[u]:n,i?n[u+1]:n,f,g);N.length=0;var C=e[r-1],a=t.cartesianToCartographic(C,I),C=(a.height=i?n[r-1]:n,t.cartographicToCartesian(a,V));return m.Cartesian3.pack(C,f,h-3),f},y.generateCartesianArc=function(a){for(var e=y.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},y.generateCartesianRhumbArc=function(a){for(var e=y.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=y});
